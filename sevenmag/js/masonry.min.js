/* Masonry */ (function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{e(jQuery)}})(function(e){"use strict";function n(e,t){this.container=e;this.options=t;this.container.trigger("start");this.init();this.container.trigger("ready")}function r(e){function t(e,t){return t.toUpper()}var n={};var r=e.data();for(var i in r){n[i.replace(/-(\w)/g,t)]=r[i]}return n}function i(e){var t={};t.height=parseInt(e.attr("height"),10);t.width=parseInt(e.attr("width"),10);if(t.height===0||t.width===0){var n=new Image;n.src=e.attr("src");t.width=n.width;t.height=n.height}return t}var t=0;e.fn.mosaicflow=function(t){var i=Array.prototype.slice.call(arguments,0);return this.each(function(){var s=e(this);var o=s.data("mosaicflow");if(!o){t=e.extend({},e.fn.mosaicflow.defaults,t,r(s));o=new n(s,t);s.data("mosaicflow",o)}else if(typeof t==="string"){o[t](i[1])}})};e.fn.mosaicflow.defaults={itemSelector:"> *",columnClass:"mosaicflow__column",minItemWidth:320,itemHeightCalculation:"auto"};n.prototype={init:function(){this.__uid=t++;this.__uidItemCounter=0;this.items=this.container.find(this.options.itemSelector);this.columns=e([]);this.columnsHeights=[];this.itemsHeights={};this.tempContainer=e("<div>").css({visibility:"hidden",width:"100%"});this.workOnTemp=false;this.autoCalculation=this.options.itemHeightCalculation==="auto";this.container.append(this.tempContainer);var n=this;this.items.each(function(){var t=e(this);var r=t.attr("id");if(!r){r=n.generateUniqueId();t.attr("id",r)}});this.container.css("visibility","hidden");if(this.autoCalculation){e(window).load(e.proxy(this.refill,this))}else{this.refill()}e(window).resize(e.proxy(this.refill,this))},refill:function(){this.container.trigger("fill");this.numberOfColumns=Math.floor(this.container.width()/this.options.minItemWidth);if(this.numberOfColumns<1)this.numberOfColumns=1;var e=this.ensureColumns();if(e){this.fillColumns();this.columns.filter(":hidden").remove()}this.container.css("visibility","visible");this.container.trigger("filled")},ensureColumns:function(){var t=this.columns.length;var n=this.numberOfColumns;this.workingContainer=t===0?this.tempContainer:this.container;if(n>t){var r=n-t;for(var i=0;i<r;i++){var s=e("<div>",{"class":this.options.columnClass});this.workingContainer.append(s)}}else if(n<t){var o=t;while(n<=o){this.columns.eq(o).hide();o--}var u=t-n;this.columnsHeights.splice(this.columnsHeights.length-u,u)}if(n!==t){this.columns=this.workingContainer.find("."+this.options.columnClass);this.columns.css("width",100/n+"%");return true}return false},fillColumns:function(){var e=this.numberOfColumns;var t=this.items.length;for(var n=0;n<e;n++){var r=this.columns.eq(n);this.columnsHeights[n]=0;for(var i=n;i<t;i+=e){var s=this.items.eq(i);var o=0;r.append(s);if(this.autoCalculation){o=s.outerHeight()}else{o=parseInt(s.find("img").attr("height"),10)}this.itemsHeights[s.attr("id")]=o;this.columnsHeights[n]+=o}}this.levelBottomEdge(this.itemsHeights,this.columnsHeights);if(this.workingContainer===this.tempContainer){this.container.append(this.tempContainer.children())}this.container.trigger("mosaicflow-layout")},levelBottomEdge:function(t,n){while(true){var r=e.inArray(Math.min.apply(null,n),n);var i=e.inArray(Math.max.apply(null,n),n);if(r===i)return;var s=this.columns.eq(i).children().last();var o=t[s.attr("id")];var u=n[r];var a=n[i];var f=u+o;if(f>=a)return;this.columns.eq(r).append(s);n[i]-=o;n[r]+=o}},add:function(t){this.container.trigger("add");var n=e.inArray(Math.min.apply(null,this.columnsHeights),this.columnsHeights);var r=0;if(this.autoCalculation){t.css({position:"static",visibility:"hidden",display:"block"}).appendTo(this.columns.eq(n));r=t.outerHeight();var s=t.find("img");if(s.length!==0){s.each(function(){var t=e(this);var n=i(t);var s=t.width()*n.height/n.width;r+=s})}t.detach().css({position:"static",visibility:"visible"})}else{r=parseInt(t.find("img").attr("height"),10)}if(!t.attr("id")){t.attr("id",this.generateUniqueId())}var o=this.items.toArray();o.push(t);this.items=e(o);this.itemsHeights[t.attr("id")]=r;this.columnsHeights[n]+=r;this.columns.eq(n).append(t);this.levelBottomEdge(this.itemsHeights,this.columnsHeights);this.container.trigger("mosaicflow-layout");this.container.trigger("added")},remove:function(e){this.container.trigger("remove");var t=e.parents("."+this.options.columnClass);this.columnsHeights[t.index()-1]-=this.itemsHeights[e.attr("id")];e.detach();this.items=this.items.not(e);this.levelBottomEdge(this.itemsHeights,this.columnsHeights);this.container.trigger("mosaicflow-layout");this.container.trigger("removed")},empty:function(){var t=this.numberOfColumns;this.items=e([]);this.itemsHeights={};for(var n=0;n<t;n++){var r=this.columns.eq(n);this.columnsHeights[n]=0;r.empty()}this.container.trigger("mosaicflow-layout")},recomputeHeights:function(){function t(t,r){r=e(r);var s=0;if(n.autoCalculation){s=r.outerHeight()}else{s=parseInt(r.find("img").attr("height"),10)}n.itemsHeights[r.attr("id")]=s;n.columnsHeights[i]+=s}var n=this;var r=this.numberOfColumns;for(var i=0;i<r;i++){var s=this.columns.eq(i);this.columnsHeights[i]=0;s.children().each(t)}},generateUniqueId:function(){this.__uidItemCounter++;return"mosaic-"+this.__uid+"-itemid-"+this.__uidItemCounter}};e(function(){e(".mosaicflow").mosaicflow()})});